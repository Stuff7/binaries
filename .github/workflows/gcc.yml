name: Install MSYS2 and Push Binaries

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    
    - name: Download MSYS2 Installer
      run: |
        $url = 'https://github.com/msys2/msys2-installer/releases/download/2023-07-18/msys2-x86_64-20230718.exe'
        Invoke-WebRequest -Uri $url -OutFile 'msys2-installer.exe'
    
    - name: Install MSYS2
      run: |
        .\msys2-installer.exe in --confirm-command --accept-messages --root $PWD
    
    - name: Run MSYS2 Command
      run: |
        .\msys2_shell.cmd -defterm -no-start -mingw64 -here -c "pacman -S mingw-w64-ucrt-x86_64-gcc"
    
    - name: Set up Git
      run: |
        git config user.name "GitHub Action"
        git config user.email "action@github.com"
    
    - name: Create Binaries Branch
      run: |
        git checkout -b binaries
        git add .
        git commit -m "Add MSYS2 installation and gcc"
        git push origin binaries --force
